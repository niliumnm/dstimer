

# 用户接口

## 查询全部用户 

方法：GET  需携带Token

URL：http://localhost:9090/user

传入：无

返回格式：JSON例子如下

```json
[
    {
        "id": 1,
        "name": "孙悟空",
        "nickname": "齐天大圣",
        "password": "123456",
        "avatar_url": null,
        "sex": "男",
        "email": "888888@qq.com",
        "created_at": "2022-05-31 11:16:07",
        "updated_at": null,
        "phone": "188888888"
    },
    {
        "id": 2,
        "name": "猪八戒",
        "nickname": "净坛使者",
        "password": "88888",
        "avatar_url": null,
        "sex": "男",
        "email": "123456@qq.com",
        "created_at": "2022-05-31 11:18:36",
        "updated_at": null,
        "phone": "1788888888"
    },
    {
        "id": 3,
        "name": "唐僧",
        "nickname": "金蝉子",
        "password": "123456",
        "avatar_url": null,
        "sex": "男",
        "email": "8999999@163.com",
        "created_at": "2022-05-31 11:19:29",
        "updated_at": null,
        "phone": "17899999999"
    },
    {
        "id": 4,
        "name": "白骨精",
        "nickname": "白骨夫人",
        "password": "123456",
        "avatar_url": null,
        "sex": "男",
        "email": "89999999@qq.com",
        "created_at": "2022-05-31 11:20:08",
        "updated_at": null,
        "phone": "+867894561"
    }
]
```

## 插入用户/更新用户

方法：POST 需携带Token

URL：http://localhost:9090/user/save

**用法1 传入其他参数，但是不带id**

实例：

传入：

```JSON
{
        "name": "新插入对象",
        "nickname": "大鹏元帅",
        "password": "123456",
        "avatar_url": "https://m.duitang.com/blog/?id=1391351457&belong_album=109495738",
        "sex": "男",
        "email": "89999999@qq.com",
        "phone": "+867894561",
        "address": "天界"
}
```

成功存入 


```json
{
    "code": "200",
    "msg": "",
    "data": true
}
```

失败 不允许用户名重复(可能) / 系统异常

后端里暂时没写判失败的逻辑，存不上就是数据或者连接有问题

```json
{
    "timestamp": "2022-06-02T11:55:43.333+00:00",
    "status": 500,
    "error": "Internal Server Error",
    "path": "/user/save"
}
```



**用法2 连ID一起传 表示更新已有的某条记录** 

```json
{
        "id":"8",
        "name": "大鹏鸟",
        "nickname": "大鹏元帅",
        "password": "123456",
        "avatar_url": "https://m.duitang.com/blog/?id=1391351457&belong_album=109495738",
        "sex": "男",
        "email": "89999999@qq.com",
        "phone": "+867894561",
        "address": "天界"
}
```

id为8的元素信息被更新

![image-20220601205923160](接口文档.assets/image-20220601205923160.png)

返回格式

```json
{
    "code": "200",
    "msg": "",
    "data": true
}
```

## 注册

方法：POST 无需携带Token头

URL：http://localhost:9090/user/register

传值：JSON 实例

```json
{
    "name":"测试用户",
    "password":"123456"
}
```

返回值

```json
{
    "code": "200",
    "msg": "",
    "data": {
        "id": 19,
        "name": "测试用户",
        "nickname": null,
        "password": "e10adc3949ba59abbe56e057f20f883e",
        "avatarUrl": null,
        "sex": null,
        "email": null,
        "phone": null,
        "address": null,
        "createdAt": null,
        "updatedAt": null
    }
}
```



## 登录 

已使用Token和MD5加密

方法：POST 无需携带Token头

URL：http://localhost:9090/user/login

参数 JSON

```json
{
    "name":"白骨精",
    "password":"123456"
}
```

返回这个用户的信息 (仅name+password+avatarUrl 详细信息请用查询信息接口)

```json
{
    "code": "200",
    "msg": "",
    "data": {
        "name": "测试用户",
        "password": "e10adc3949ba59abbe56e057f20f883e",
        "avatarUrl": null,
        "token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJhdWQiOiIxOSIsImV4cCI6MTY1NDE4ODYzOX0.EBBpLDnLXy3VmQqEr6-SoIOXPzl_bZbcSExi0lyF61Q"
    }
}
```



## 删除用户

方法：DELETE 需携带Token

URL：http://localhost:9090/user/{id}

例：删除id为7的用户

发送DELETE http://localhost:9090/user/7

用户即被删除 返回true



## 用户名查信息

**用户名在数据库里必须是唯一的 重复的会报错**

方法：POST 需携带Token

URL：http://localhost:9090/user/username/用户名

用例 POST：http://localhost:9090/user/username/白骨精

返回值

```json
{
    "code": "200",
    "msg": "",
    "data": {
        "id": 4,
        "name": "白骨精",
        "nickname": "白骨夫人",
        "password": "123456",
        "avatarUrl": null,
        "sex": "男",
        "email": "89999999@qq.com",
        "phone": "+867894561",
        "address": null,
        "createdAt": "2022-05-31T11:20:08",
        "updatedAt": null
    }
}
```

## ID查用户

方法：GET 需携带Token

URL：http://localhost:9090/user/{id}

用例：GET:http://localhost:9090/user/15

返回值

```json
{
    "code": "200",
    "msg": "",
    "data": {
        "id": 15,
        "name": "白骨3精",
        "nickname": null,
        "password": "123456",
        "avatarUrl": null,
        "sex": null,
        "email": null,
        "phone": null,
        "address": null,
        "createdAt": "2022-06-02T19:54:23",
        "updatedAt": null
    }
}
```



## 分页查询用户

方法：GET 需携带Token

`http://localhost:9090/user/page?pageNum=页码&pageSize=条数`



**用法1 不传名字 结果是某一页的信息**

`http://localhost:9090/user/page?pageNum=2&pageSize=2`

返回格式

```json
{
    "records": [
        {
            "id": 3,
            "name": "唐僧",
            "nickname": "金蝉子",
            "password": "123456",
            "avatar_url": null,
            "sex": "男",
            "email": "8999999@163.com",
            "created_at": null,
            "updated_at": null,
            "phone": "17899999999",
            "address": null
        },
        {
            "id": 4,
            "name": "白骨精",
            "nickname": "白骨夫人",
            "password": "123456",
            "avatar_url": null,
            "sex": "男",
            "email": "89999999@qq.com",
            "created_at": null,
            "updated_at": null,
            "phone": "+867894561",
            "address": null
        }
    ],
    "total": 5,
    "size": 2,
    "current": 2,
    "orders": [],
    "optimizeCountSql": true,
    "searchCount": true,
    "countId": null,
    "maxLimit": null,
    "pages": 3
}
```

注意，total是查出的全部内容，但是实际的显示的元素不一定有total条，因为有分页的限制；比如这里分页传了2，total查出来5个，但是只显示俩，因为你要求分页每页两个。

**用法2 传名字 相当于搜索用户名 将返回结果分页  用户名可以传一部分**

比如要搜索猪八戒，只传猪、猪八也能搜出来；结果将根据参数分页。

注意，如果结果只有两条，你要求`pageSize` 10条 `pageNum` 2，会报错，因为每页10条的时候不可能有第二页。

例

`http://localhost:9090/user/page?pageNum=1&pageSize=3&name=孙悟空`

返回结果

```json
{
    "records": [
        {
            "id": 1,
            "name": "孙悟空",
            "nickname": "齐天大圣",
            "password": "123456",
            "avatar_url": null,
            "sex": "男",
            "email": "888888@qq.com",
            "created_at": null,
            "updated_at": null,
            "phone": "188888888",
            "address": null
        }
    ],
    "total": 1,
    "size": 3,
    "current": 1,
    "orders": [],
    "optimizeCountSql": true,
    "searchCount": true,
    "countId": null,
    "maxLimit": null,
    "pages": 1
}
```

## 附录

### 部署

1. 导入sql， sql已经导出在文件夹里

![image-20220602104507065](接口文档.assets/image-20220602104507065.png)

2. 更改src/main/resources/application.yaml 

![image-20220602104220945](接口文档.assets/image-20220602104220945.png)

改成你的数据库账号密码

### 我的状态码定义

```java
    //OK
    String CODE_200 = "200";

    //BAD 系统错误
    String CODE_500 = "500";

    //权限不足
    String CODE_401 = "401";

    //系统错误
    String CODE_400 = "400";

    //其他业务异常
    String CODE_600 = "600";
```

返回的包装类定义

```json
public class Result {
    //状态码
    private String code;

    //提示信息
    private String msg;

    //返回给前端的数据 如果有的话
    private Object data;
}
```

举例

```json
{
    "code": "600",
    "msg": "用户已存在",
    "data": null
}
```

状态码600 信息：用户已存在 无返回数据

### (先看这个)Postman Token测试方法

Step1：切换login接口 获取Token

![image-20220602213258943](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20220602213258943.png)

复制token 点击PostMan右上角小眼睛

![image-20220602213333666](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20220602213333666.png)

点击Add，把刚才的token加入到这里面 VARIABLE取名叫token 顺便取个名，这里叫测试环境

![image-20220602213541027](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20220602213541027.png)



![image-20220602213406457](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20220602213406457.png)



现在可以测试其他接口了，测试前在header里添加以下字段

![image-20220602213632055](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20220602213632055.png)

完成

https://segmentfault.com/a/1190000041570218 参考新版Postman如何设置Token

